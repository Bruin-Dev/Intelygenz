
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.mettel-automation.net/1.142.0/LOGGING_AND_MONITORING/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.2.11">
    
    
      
        <title>LOGGING AND MONITORING - Automation Engine Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8c5ef100.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.9647289d.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#logging-and-monitoring" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Automation Engine Documentation" class="md-header__button md-logo" aria-label="Automation Engine Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Automation Engine Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              LOGGING AND MONITORING
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../CONCEPTS/" class="md-tabs__link">
        Topics
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Automation Engine Documentation" class="md-nav__button md-logo" aria-label="Automation Engine Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Automation Engine Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Topics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Topics" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Topics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../CONCEPTS/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          Pipelines
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pipelines" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Pipelines
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline/BASIC_CI_CONFIGURATION/" class="md-nav__link">
        Basic configurations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline/PIPELINE_RULES/" class="md-nav__link">
        Pipeline rules
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3">
          Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Documentation" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../DOCUMENTATION/" class="md-nav__link">
        Organization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../decisions/" class="md-nav__link">
        MetTel decisions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../metrics-definitions/" class="md-nav__link">
        Metrics definitions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Development rules
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" type="checkbox" id="__nav_2_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5">
          Work in a local env
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Work in a local env" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          Work in a local env
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kafka/LAUNCH_DOCKER_COMPOSE/" class="md-nav__link">
        Launch docker compose
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../snowflake/" class="md-nav__link">
        Datalake
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Manual processes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cloudwatch" class="md-nav__link">
    Cloudwatch
  </a>
  
    <nav class="md-nav" aria-label="Cloudwatch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloudwatch-log-groups" class="md-nav__link">
    Cloudwatch Log Groups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloudwatch-log-streams" class="md-nav__link">
    Cloudwatch Log Streams
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloudwatch-retention-period" class="md-nav__link">
    Cloudwatch Retention Period
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloudwatch-logs-retrieval-tool" class="md-nav__link">
    Cloudwatch logs retrieval tool
  </a>
  
    <nav class="md-nav" aria-label="Cloudwatch logs retrieval tool">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-and-install" class="md-nav__link">
    Download and install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-of-usage" class="md-nav__link">
    Example of usage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#papertrail" class="md-nav__link">
    Papertrail
  </a>
  
    <nav class="md-nav" aria-label="Papertrail">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#papertrail-dashboards" class="md-nav__link">
    Papertrail dashboards
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#papertrail-logging-configuration" class="md-nav__link">
    Papertrail logging configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#papertrail-searches-configuration" class="md-nav__link">
    Papertrail searches configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<div align="center">
<img src="https://media.licdn.com/dms/image/C4E0BAQHrME9aCW6ulg/company-logo_200_200/0?e=2159024400&v=beta&t=6xMNS1zK1F8asBlM16EzbJ4Im7SlQ8L7a7sgcaNzZQE"  width="200" height="200">
</div>

<h1 id="logging-and-monitoring">Logging and Monitoring</h1>
<h2 id="cloudwatch">Cloudwatch</h2>
<h3 id="cloudwatch-log-groups">Cloudwatch Log Groups</h3>
<p>A log group is created in <a href="https://docs.aws.amazon.com/cloudwatch/index.html">Cloudwatch</a> for the different environments deployed in AWS:</p>
<ul>
<li>
<p><strong>Production environment</strong>: A log group will be created with the name <code>automation-master</code> in which the different <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/Working-with-log-groups-and-streams.html">logStreams</a> will be created to store the logs of the different ECS services for the production environment.</p>
</li>
<li>
<p><strong>Ephemeral environments</strong>: A <code>log group</code> will be created with the name <code>automation-&lt;branch_identifier&gt;</code> for ephemeral environments, being <code>branch_identifier</code> the result of applying <code>echo -n "&lt;branch_name&gt;" | sha256sum | cut -c1-8</code> on the branch name related to the ephemeral environment, the <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/Working-with-log-groups-and-streams.html">logStreams</a> required for the different ECS services deployed in that environment will be created using the mentioned <code>log group</code>.</p>
</li>
</ul>
<h3 id="cloudwatch-log-streams">Cloudwatch Log Streams</h3>
<p>As mentioned in the previous section, the different <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/Working-with-log-groups-and-streams.html">logStreams</a> of the deployed services will be stored in a specific <code>logGroup</code> for each environment. A logStream will be created for each of the ECS cluster services tasks created in each environment, which will follow the following scheme</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>&lt;environment_name&gt;-&lt;microservice_image_build_number&gt;/&lt;microservice_name&gt;/&lt;ecs_tasks_id&gt;
</code></pre></div>
<ul>
<li>
<p><code>environment_name</code>: The names for environments are <code>automation-master</code> for production, as well as <code>automation-&lt;branch_identifier&gt;</code> for ephemeral environments, being <code>branch_identifier</code> the result of applying <code>echo -n "&lt;branch_name&gt;" | sha256sum | cut -c1-8</code> on the branch name related to the ephemeral environment.</p>
</li>
<li>
<p><code>microservice_image_build_number</code>: The pipeline number is used as build number to build the image of those microservices that need to build a new docker image.</p>
</li>
<li>
<p><code>microservice_name</code>: The name of the microservice deployed in ECS, e.g. <code>bruin-bridge</code>.</p>
</li>
<li>
<p><code>ecs_task_id&gt;</code>: For each ECS service, one or several tasks are created, depending on the desired number in the service, these tasks are identified with an identifier formed by number and letters, e.g. <code>961ef51b61834a2e9dd804db564a9fe0</code>.</p>
</li>
</ul>
<h3 id="cloudwatch-retention-period">Cloudwatch Retention Period</h3>
<p>All environments deployed on AWS have been configured to use <a href="https://docs.aws.amazon.com/cloudwatch/index.html">Cloudwatch</a> to record the logs of the microservices present in them, although it is important to note the following differences:</p>
<ul>
<li>
<p><strong>Production environment</strong>: The retention period of the log group created for such an environment is 90 days.</p>
</li>
<li>
<p><strong>Ephemeral environments</strong>: The retention period of the log group created for such an environment is 14 days.</p>
</li>
</ul>
<blockquote>
<p>This retention period is configured in the <a href="../infra-as-code/dev/logs.tf">infra-as-code/dev/logs.tf</a> file.</p>
</blockquote>
<h3 id="cloudwatch-logs-retrieval-tool">Cloudwatch logs retrieval tool</h3>
<p>It is possible to obtain the events in logs of a logGroup through a tool designed for this purpose available in Github called <a href="https://github.com/xoanmm/log-stream-filter">log-stream-filter</a>.</p>
<h4 id="download-and-install">Download and install</h4>
<p>This tool is available for Linux, MacOS and Windows, it is possible to download the latest binary for each of these OSs:</p>
<ul>
<li>
<p><strong>Linux</strong>:</p>
<ul>
<li>It's possible download and install as a <code>deb</code> package
    <div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>curl -o log-stream-filter.deb -L <span class="k">$(</span>curl -s https://api.github.com/repos/xoanmm/log-stream-filter/releases/latest <span class="p">|</span> jq -r <span class="s1">&#39;.assets[] | select(.name | contains(&quot;linux_amd64.deb&quot;)) | .browser_download_url&#39;</span><span class="k">)</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>sudo dpkg -i log-stream-filter.deb
</code></pre></div></li>
<li>It's also possible download and install as a simple binary
    <div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>curl -o log-stream-filter.tgz -L <span class="k">$(</span>curl -s https://api.github.com/repos/xoanmm/log-stream-filter/releases/latest <span class="p">|</span> jq -r <span class="s1">&#39;.assets[] | select(.name | contains(&quot;linux_64-bit.tar.gz&quot;)) | .browser_download_url&#39;</span><span class="k">)</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>tar -zxvf log-stream-filter.tgz
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>chmod +x ./log-stream-filter <span class="o">&amp;&amp;</span> sudo mv ./log-stream-filter /usr/local/bin
</code></pre></div></li>
<li><strong>MacOS</strong>:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>curl -o log-stream-filter.tgz -L <span class="k">$(</span>curl -s https://api.github.com/repos/xoanmm/log-stream-filter/releases/latest <span class="p">|</span> jq -r <span class="s1">&#39;.assets[] | select(.name | contains(&quot;macOS&quot;)) | .browser_download_url&#39;</span><span class="k">)</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>tar -zxvf log-stream-filter.tgz
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>chmod +x ./log-stream-filter <span class="o">&amp;&amp;</span> sudo mv ./log-stream-filter /usr/local/bin
</code></pre></div>
</li>
<li>
<p><strong>Windows</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>curl -o log-stream-filter.zip -L <span class="k">$(</span>curl -s https://api.github.com/repos/xoanmm/log-stream-filter/releases/latest <span class="p">|</span> jq -r <span class="s1">&#39;.assets[] | select(.name | contains(&quot;windows&quot;)) | .browser_download_url&#39;</span><span class="k">)</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>unzip log-stream-filter.zip
</code></pre></div>
</li>
</ul>
<h4 id="example-of-usage">Example of usage</h4>
<ul>
<li>Example of search text <code>Outage monitoring process finished</code> between <code>04/06/2021 12:00:00</code> and <code>04/07/2021 12:00:00</code> in log group with name <code>automation-master</code> for log streams that match with name <code>service-outage-monitor-1</code> using AWS profile with name <code>mettel-automation</code>:
    <div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>$ log-stream-filter -n <span class="s2">&quot;automation-master&quot;</span> -l <span class="s2">&quot;service-outage-monitor-1&quot;</span> -a <span class="s2">&quot;mettel-automation&quot;</span> -s <span class="s2">&quot;04/06/2021 12:00:00&quot;</span> -e <span class="s2">&quot;04/07/2021 12:00:00&quot;</span> -T <span class="s2">&quot;Outage monitoring process finished&quot;</span> -t <span class="nb">true</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>Filtering logs <span class="k">for</span> logGroup automation-master
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>params: <span class="o">[</span>aws-profile mettel-automation<span class="o">]</span> <span class="o">[</span>log-stream-filter: service-outage-monitor-1<span class="o">]</span> <span class="o">[</span>search-term-search: true<span class="o">]</span> <span class="o">[</span>search-term: Outage monitoring process finished<span class="o">]</span> <span class="o">[</span>path: /tmp<span class="o">]</span> <span class="o">[</span>start-date: <span class="m">04</span>/06/2021 <span class="m">12</span>:00:00<span class="o">]</span> <span class="o">[</span>end-date: <span class="m">04</span>/07/2021 <span class="m">12</span>:00:00<span class="o">]</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>Getting logStreams <span class="k">for</span> logGroup automation-master applying filter service-outage-monitor-1
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>Getting the logEvents <span class="k">for</span> those logStreams whose last event was inserted between <span class="m">04</span>/06/2021 <span class="m">12</span>:00:00 and <span class="m">04</span>/07/2021 <span class="m">12</span>:00:00
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>****************************************************************************************************
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>LogStreamName: automation-master-75993/service-outage-monitor-1/75d4e2cbb3f64e84a97063d34ffe6177
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>CreationTime: <span class="m">04</span>/05/2021 <span class="m">23</span>:08:29
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>LastEventTime: <span class="m">04</span>/06/2021 <span class="m">12</span>:43:49
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>All log events are going to be retrieved <span class="k">in</span> logGroup automation-master <span class="k">for</span> logStream automation-master-75993/service-outage-monitor-1/75d4e2cbb3f64e84a97063d34ffe6177 from <span class="nb">time</span> <span class="m">1617710400000</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>Event messages <span class="k">for</span> stream automation-master-75993/service-outage-monitor-1/75d4e2cbb3f64e84a97063d34ffe6177 <span class="k">in</span> log group automation-master are going to be saved <span class="k">in</span> the following files
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>- /tmp/automation-master-75993_service-outage-monitor-1_75d4e2cbb3f64e84a97063d34ffe6177-Outage_monitoring_process_finished
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>****************************************************************************************************
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>****************************************************************************************************
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>LogStreamName: automation-master-76009/service-outage-monitor-1/aab10e3e029c44fcb08dddeb51431fa2
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>CreationTime: <span class="m">04</span>/06/2021 <span class="m">12</span>:44:40
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>LastEventTime: <span class="m">04</span>/07/2021 <span class="m">10</span>:39:16
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>All log events are going to be retrieved <span class="k">in</span> logGroup automation-master <span class="k">for</span> logStream automation-master-76009/service-outage-monitor-1/aab10e3e029c44fcb08dddeb51431fa2 from <span class="nb">time</span> <span class="m">1617710400000</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>Event messages <span class="k">for</span> stream automation-master-76009/service-outage-monitor-1/aab10e3e029c44fcb08dddeb51431fa2 <span class="k">in</span> log group automation-master are going to be saved <span class="k">in</span> the following files
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>- /tmp/automation-master-76009_service-outage-monitor-1_aab10e3e029c44fcb08dddeb51431fa2-Outage_monitoring_process_finished
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>****************************************************************************************************
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>****************************************************************************************************
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>LogStreamName: automation-master-76051/service-outage-monitor-1/c921aa5c9bf04d71b0fab6d8673946a3
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>CreationTime: <span class="m">04</span>/07/2021 <span class="m">10</span>:41:22
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>LastEventTime: <span class="m">04</span>/07/2021 <span class="m">11</span>:04:33
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>All log events are going to be retrieved <span class="k">in</span> logGroup automation-master <span class="k">for</span> logStream automation-master-76051/service-outage-monitor-1/c921aa5c9bf04d71b0fab6d8673946a3 from <span class="nb">time</span> <span class="m">1617710400000</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>Event messages <span class="k">for</span> stream automation-master-76051/service-outage-monitor-1/c921aa5c9bf04d71b0fab6d8673946a3 <span class="k">in</span> log group automation-master are going to be saved <span class="k">in</span> the following files
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>- /tmp/automation-master-76051_service-outage-monitor-1_c921aa5c9bf04d71b0fab6d8673946a3-Outage_monitoring_process_finished
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>****************************************************************************************************
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="m">3</span> files generated <span class="k">for</span> logs of logStreams filtered <span class="k">for</span> logGroup automation-master
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>Location of files where logs of logStream automation-master-75993/service-outage-monitor-1/75d4e2cbb3f64e84a97063d34ffe6177 were stored are the following
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>- /tmp/automation-master-75993_service-outage-monitor-1_75d4e2cbb3f64e84a97063d34ffe6177-Outage_monitoring_process_finished
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>Location of files where logs of logStream automation-master-76009/service-outage-monitor-1/aab10e3e029c44fcb08dddeb51431fa2 were stored are the following
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>- /tmp/automation-master-76009_service-outage-monitor-1_aab10e3e029c44fcb08dddeb51431fa2-Outage_monitoring_process_finished
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>Location of files where logs of logStream automation-master-76051/service-outage-monitor-1/c921aa5c9bf04d71b0fab6d8673946a3 were stored are the following
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>- /tmp/automation-master-76051_service-outage-monitor-1_c921aa5c9bf04d71b0fab6d8673946a3-Outage_monitoring_process_finished
</code></pre></div></li>
</ul>
<blockquote>
<p>To know all the options it is recommended to read the <a href="https://github.com/xoanmm/log-stream-filter/blob/master/README.md">README</a> of <a href="https://github.com/xoanmm/log-stream-filter">log-stream-filter</a> in github.</p>
</blockquote>
<h2 id="papertrail">Papertrail</h2>
<p>There is a <a href="https://papertrailapp.com/">papertrail</a> account used in the project for sending logs, <strong>but it will only be used for the production environment</strong>, this is because it is a high cost service and it is not feasible to have an account for all ephemeral environments due to its cost and the high volume of logs generated in these environments.</p>
<h3 id="papertrail-dashboards">Papertrail dashboards</h3>
<p>The system logs of the production environment are stored in papertrail, the account credentials are in the project's onepassword vault to which all people in the project have access.</p>
<p>Below is a screenshot of the main screen of the system.</p>
<p><img alt="IMAGE: papertrail_dashboards_overview" src="../img/papertrail/papertrail_dashboards_overview.png" /></p>
<p>In this system it's possible see three useful dashboards:</p>
<ul>
<li>
<p><strong>[production] - master alarms</strong>: alarms are defined on different modules with notifications sent to slack through the mettel-alarms-papertrail-production channel, for example when the number of error messages in a module exceeds 100 times in an hour. Below is a screenshot where these alarms have been marked in a red rectangle.</p>
<p><img alt="IMAGE: papertrail_dashboard-master_alarms" src="../img/papertrail/papertrail_dashboard-master_alarms.png" /></p>
</li>
<li>
<p><strong>[production] - master logs</strong>: searches are defined to gather the logs of the replicas of each deployed microservice. Below is a screenshot where these searches have been marked in a red rectangle.</p>
<p><img alt="IMAGE: papertrail_dashboard-master_logs" src="../img/papertrail/papertrail_dashboard-master_logs.png" /></p>
</li>
<li>
<p><strong>[production] - master notifications</strong>: Searches on different modules are defined with their notification to slack through the mettel-notifications-papertrail-production channel. Below is a screenshot where these searches have been marked in a red rectangle.</p>
<p><img alt="IMAGE: papertrail_dashboard-master_notifications" src="../img/papertrail/papertrail_dashboard-master_notifications.png" /></p>
</li>
</ul>
<h3 id="papertrail-logging-configuration">Papertrail logging configuration</h3>
<p>A certain configuration must be made for the microservices to use papertrail for sending logs in production, this configuration is made in the <code>LOG_CONFIG</code> section of the <code>config.py</code> file present in the <code>src/config</code> folder of each microservice, this configuration is shown below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nv">LOG_CONFIG</span> <span class="o">=</span> <span class="o">{</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="s1">&#39;name&#39;</span>: <span class="s1">&#39;&lt;microservice_name&gt;&#39;</span>,
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="s1">&#39;level&#39;</span>: logging.DEBUG,
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    <span class="s1">&#39;stream_handler&#39;</span>: logging.StreamHandler<span class="o">(</span>sys.stdout<span class="o">)</span>,
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="s1">&#39;format&#39;</span>: f<span class="s1">&#39;%(asctime)s: {ENVIRONMENT_NAME}: %(hostname)s: %(module)s::%(lineno)d %(levelname)s: %(message)s&#39;</span>,
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="s1">&#39;papertrail&#39;</span>: <span class="o">{</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>        <span class="s1">&#39;active&#39;</span>: True <span class="k">if</span> os.getenv<span class="o">(</span><span class="s1">&#39;PAPERTRAIL_ACTIVE&#39;</span><span class="o">)</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span> <span class="k">else</span> False,
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>        <span class="s1">&#39;prefix&#39;</span>: os.getenv<span class="o">(</span><span class="s1">&#39;PAPERTRAIL_PREFIX&#39;</span>, f<span class="s1">&#39;{ENVIRONMENT_NAME}-&lt;microservice_name&gt;&#39;</span><span class="o">)</span>,
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>        <span class="s1">&#39;host&#39;</span>: os.getenv<span class="o">(</span><span class="s1">&#39;PAPERTRAIL_HOST&#39;</span><span class="o">)</span>,
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>        <span class="s1">&#39;port&#39;</span>: int<span class="o">(</span>os.getenv<span class="o">(</span><span class="s1">&#39;PAPERTRAIL_PORT&#39;</span><span class="o">))</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    <span class="o">}</span>,
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="o">}</span>
</code></pre></div>
<blockquote>
<p>It would be necessary to put the microservice name instead of <code>microservice_name</code> for each microservice in the project</p>
</blockquote>
<h3 id="papertrail-searches-configuration">Papertrail searches configuration</h3>
<p>The <a href="../ci-utils/papertrail-provisioning">papertrail-provisioning</a> tool is available in the repository to configure the different groups of searches in papertrail, you must follow the procedure explained in the <a href="../ci-utils/papertrail-provisioning/README.md">README</a> of the same for its use.</p>
<blockquote>
<p>The above mentioned guide should be followed to add log searches for a specific microservice, it is also possible to configure alarms that will send notifications to slack.</p>
</blockquote>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs"], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.748e2769.min.js"></script>
      
    
  </body>
</html>