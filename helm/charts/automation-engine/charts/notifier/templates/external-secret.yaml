{{- if and .Values.global.externalSecrets.enabled -}}
apiVersion: external-secrets.io/v1alpha1
kind: ExternalSecret
metadata:
  name: {{ include "notifier.secretName" . }}
spec:
  secretStoreRef:
    name: {{ .Values.global.environment }}-parameter-store
    kind: SecretStore 
  target:
    creationPolicy: 'Merge'
  # Valid time units are "ns", "us" (or "Âµs"), "ms", "s", "m", "h" (from time.ParseDuration)
  # May be set to zero to fetch and create it 
  {{- if eq .Values.global.current_environment "dev" }}
  refreshInterval: "0"
  {{ else }}
  refreshInterval: "5m"  
  {{- end }}
  data:
    {{- with .Values.global.externalSecrets.envPath }}
    # GLOBAL CONFIG
    - secretKey: NATS_SERVER1
      remoteRef:
        key: {{ . }}/nats/endpoint-url
    - secretKey: PAPERTRAIL_ACTIVE
      remoteRef:
        key: {{ . }}/papertrail/enabled
    - secretKey: PAPERTRAIL_HOST
      remoteRef:
        key: {{ . }}/papertrail/host
    - secretKey: PAPERTRAIL_PORT
      remoteRef:
        key: {{ . }}/papertrail/port
    - secretKey: REDIS_HOSTNAME
      remoteRef:
        key: {{ . }}/redis/main-hostname
    - secretKey: TIMEZONE
      remoteRef:
        key: {{ . }}/timezone
    # SPECIFIC CONFIG
    - secretKey: EMAIL_ACCOUNT_FOR_MESSAGE_DELIVERY_PASSWORD
      remoteRef:
        key: {{ . }}/notifier/email-account-for-message-delivery-password
    - secretKey: EMAIL_ACCOUNT_FOR_MESSAGE_DELIVERY_USERNAME
      remoteRef:
        key: {{ . }}/notifier/email-account-for-message-delivery-username
    - secretKey: MONITORABLE_EMAIL_ACCOUNTS
      remoteRef:
        key: {{ . }}/notifier/monitorable-email-accounts
    - secretKey: SLACK_WEBHOOK
      remoteRef:
        key: {{ . }}/notifier/slack-webhook-url
    {{- end }}
{{- end }}
