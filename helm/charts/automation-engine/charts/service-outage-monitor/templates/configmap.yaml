{{- range $som_monitored_velocloud_hosts, $val := .Values.config.som_monitored_velocloud_hosts }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: "{{ include "service-outage-monitor.fullname" $ }}{{ $som_monitored_velocloud_hosts | add1 }}-{{ . | replace "." "-" }}-configmap"
  labels:
    {{- include "service-outage-monitor.labels" $ | nindent 4 }}
    velocloud_host: {{ . | quote }}
    velocloud_host_id: {{ $som_monitored_velocloud_hosts | add1 | quote }}
  annotations:
    reloader.stakater.com/match: "true"
data:
  CURRENT_ENVIRONMENT: {{ $.Values.global.current_environment }}
  ENVIRONMENT_NAME: {{ $.Values.global.environment | quote }}
  NATS_SERVER1: {{ $.Values.global.nats_server }}
  REDIS_HOSTNAME: {{ $.Values.global.redis_hostname }}
  PAPERTRAIL_ACTIVE: {{ $.Values.global.papertrail_active | quote }}
  PAPERTRAIL_HOST: {{ $.Values.global.papertrail_host }}
  PAPERTRAIL_PORT: {{ $.Values.global.papertrail_port | quote }}
  PAPERTRAIL_PREFIX: "{{ include "service-outage-monitor.fullname" $ }}{{ $som_monitored_velocloud_hosts | add1 }}-{{ . | replace "." "-" }}-{{ $.Values.image.tag }}"
  LAST_CONTACT_RECIPIENT: {{ $.Values.global.last_contact_recipient }}
  VELOCLOUD_HOSTS: {{ . | quote }}
  VELOCLOUD_HOSTS_FILTER: {{ $.Values.config.velocloud_hosts_filter | quote }}
  ENABLE_TRIAGE_MONITORING: {{ $.Values.config.enable_triage_monitoring | quote }}
{{- end }}
