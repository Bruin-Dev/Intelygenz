
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://docs.mettel-automation.net/1.16.0/CREATE_NEW_MICROSERVICE/" rel="canonical"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.3.1, mkdocs-material-8.2.11" name="generator"/>
<title>Creating new services - Automation Engine Documentation</title>
<link href="../assets/stylesheets/main.8c5ef100.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.9647289d.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="none" data-md-color-primary="none" data-md-color-scheme="" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#create-new-microservice">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-component="outdated" hidden="">
<aside class="md-banner md-banner--warning">
</aside>
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Automation Engine Documentation" class="md-header__button md-logo" data-md-component="logo" href=".." title="Automation Engine Documentation">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Automation Engine Documentation
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Creating new services
            
          </span>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Automation Engine Documentation" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Automation Engine Documentation">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    Automation Engine Documentation
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" id="__nav_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_1">
          Concepts
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Concepts" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
          Concepts
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../MONOREPO/">
        Monorepo
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
          CI/CD Pipelines
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="CI/CD Pipelines" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          CI/CD Pipelines
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../pipeline/BASIC_CI_CONFIGURATION/">
        Pre-requisites
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../pipeline/PIPELINE_RULES/">
        Setting up pipelines
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
          Documentation
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Documentation" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Documentation
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../DOCUMENTATION/">
        About this documentation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../decisions/">
        Architecture Decision Records (ADRs)
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" id="__nav_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3">
          Business
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Business" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_3">
<span class="md-nav__icon md-icon"></span>
          Business
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../metrics-definitions/">
        Metrics Definitions
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../parameters/parameters/">
        System Configuration
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3" id="__nav_3_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3">
          Workflows
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Workflows" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_3_3">
<span class="md-nav__icon md-icon"></span>
          Workflows
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/messages-bus/">
        Communication between services
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3_2" id="__nav_3_3_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3_2">
          Bridges
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Bridges" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_3_3_3_2">
<span class="md-nav__icon md-icon"></span>
          Bridges
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/bruin-bridge/">
        Bruin
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/digi-bridge/">
        DiGi
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/dri-bridge/">
        DRI (Data Remote Portal)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/email-bridge/">
        E-mail Services
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/hawkeye-bridge/">
        Hawkeye / Ixia
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/notifications-bridge/">
        Notification Services
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/servicenow-bridge/">
        ServiceNow
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/velocloud-bridge/">
        VeloCloud
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3_3" id="__nav_3_3_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3_3">
          Use cases
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Use cases" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_3_3_3_3">
<span class="md-nav__icon md-icon"></span>
          Use cases
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3_3_1" id="__nav_3_3_3_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3_3_1">
          Caching Services
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Caching Services" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_3_3_3_3_1">
<span class="md-nav__icon md-icon"></span>
          Caching Services
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/hawkeye-customer-cache/">
        Hawkeye / Ixia
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/customer-cache/">
        VeloCloud
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3_3_2" id="__nav_3_3_3_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3_3_2">
          DiGi
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="DiGi" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_3_3_3_3_2">
<span class="md-nav__icon md-icon"></span>
          DiGi
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3_3_2_1" id="__nav_3_3_3_3_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3_3_2_1">
          Reporting
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Reporting" class="md-nav" data-md-level="6">
<label class="md-nav__title" for="__nav_3_3_3_3_2_1">
<span class="md-nav__icon md-icon"></span>
          Reporting
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/digi-reboot-report/">
        Reboot Report
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3_3_3" id="__nav_3_3_3_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3_3_3">
          Fraud
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Fraud" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_3_3_3_3_3">
<span class="md-nav__icon md-icon"></span>
          Fraud
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3_3_3_1" id="__nav_3_3_3_3_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3_3_3_1">
          Monitoring
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Monitoring" class="md-nav" data-md-level="6">
<label class="md-nav__title" for="__nav_3_3_3_3_3_1">
<span class="md-nav__icon md-icon"></span>
          Monitoring
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/fraud-monitor/">
        Fraud Alerts
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3_3_4" id="__nav_3_3_3_3_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3_3_4">
          Hawkeye / Ixia
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Hawkeye / Ixia" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_3_3_3_3_4">
<span class="md-nav__icon md-icon"></span>
          Hawkeye / Ixia
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3_3_4_1" id="__nav_3_3_3_3_4_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3_3_4_1">
          Monitoring
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Monitoring" class="md-nav" data-md-level="6">
<label class="md-nav__title" for="__nav_3_3_3_3_4_1">
<span class="md-nav__icon md-icon"></span>
          Monitoring
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/hawkeye-outage-monitor/">
        Service Outage
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3_3_5" id="__nav_3_3_3_3_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3_3_5">
          InterMapper
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="InterMapper" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_3_3_3_3_5">
<span class="md-nav__icon md-icon"></span>
          InterMapper
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3_3_5_1" id="__nav_3_3_3_3_5_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3_3_5_1">
          Monitoring
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Monitoring" class="md-nav" data-md-level="6">
<label class="md-nav__title" for="__nav_3_3_3_3_5_1">
<span class="md-nav__icon md-icon"></span>
          Monitoring
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/intermapper-outage-monitor/">
        Service Outage
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3_3_6" id="__nav_3_3_3_3_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3_3_6">
          LuminAI
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="LuminAI" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_3_3_3_3_6">
<span class="md-nav__icon md-icon"></span>
          LuminAI
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3_3_6_1" id="__nav_3_3_3_3_6_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3_3_6_1">
          Reporting
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Reporting" class="md-nav" data-md-level="6">
<label class="md-nav__title" for="__nav_3_3_3_3_6_1">
<span class="md-nav__icon md-icon"></span>
          Reporting
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/lumin-billing-report/">
        Billing Report
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/task-dispatcher/">
        Tasks scheduling
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3_3_8" id="__nav_3_3_3_3_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3_3_8">
          VeloCloud
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="VeloCloud" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_3_3_3_3_8">
<span class="md-nav__icon md-icon"></span>
          VeloCloud
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3_3_8_1" id="__nav_3_3_3_3_8_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3_3_8_1">
          Reporting
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Reporting" class="md-nav" data-md-level="6">
<label class="md-nav__title" for="__nav_3_3_3_3_8_1">
<span class="md-nav__icon md-icon"></span>
          Reporting
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/last-contact-report/">
        Last Contact Report
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3_3_8_2" id="__nav_3_3_3_3_8_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3_3_8_2">
          Monitoring
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Monitoring" class="md-nav" data-md-level="6">
<label class="md-nav__title" for="__nav_3_3_3_3_8_2">
<span class="md-nav__icon md-icon"></span>
          Monitoring
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3_3_8_2_1" id="__nav_3_3_3_3_8_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3_3_3_8_2_1">
          SD-WAN
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="SD-WAN" class="md-nav" data-md-level="7">
<label class="md-nav__title" for="__nav_3_3_3_3_8_2_1">
<span class="md-nav__icon md-icon"></span>
          SD-WAN
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/service-affecting-monitor/">
        Service Affecting
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/service-outage-monitor/">
        Service Outage
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/events/gateway-monitor/">
        Gateways
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4">
          Working in local environments
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Working in local environments" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Working in local environments
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" id="__nav_4_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1">
          Automation
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Automation" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_1">
<span class="md-nav__icon md-icon"></span>
          Automation
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1_1" id="__nav_4_1_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1_1">
          Metrics
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Metrics" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_1">
<span class="md-nav__icon md-icon"></span>
          Metrics
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../CREATE_NEW_METRIC/">
        Creating new metrics
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1_2" id="__nav_4_1_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1_2">
          Business Services
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Business Services" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_2">
<span class="md-nav__icon md-icon"></span>
          Business Services
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Creating new services
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Creating new services
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#introduction">
    Introduction
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1-create-ecr-repository">
    1. Create ECR repository
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-create-our-new-microservice-folder">
    2. Create our new microservice folder
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-update-ci-cd-gitlab-files-with-the-proper-values">
    3. Update CI-CD gitlab files with the proper values
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-configure-semantic-release">
    3. Configure semantic-release
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-configure-logs">
    3. Configure logs
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-update-docker-compose-to-enable-local-deployments">
    3. Update docker-compose to enable local deployments
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-add-option-to-enable-or-disable-our-microservice">
    4. Add option to enable or disable our microservice
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-helm-templates-and-variables">
    5. Helm templates and variables
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2">
          Data Lake
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Data Lake" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
          Data Lake
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../kafka/LAUNCH_DOCKER_COMPOSE/">
        Running in docker-compose
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5">
          System Overview
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="System Overview" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          System Overview
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" id="__nav_5_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1">
          Automation Engine
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Automation Engine" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_1">
<span class="md-nav__icon md-icon"></span>
          Automation Engine
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../SYSTEM_OVERVIEW/">
        Architecture &amp; Infrastructure
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../INFRASTRUCTURE_AS_CODE/">
        Infrastructure as Code
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../LOGGING_AND_MONITORING/">
        Logging &amp; Monitoring
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../PIPELINES/">
        Pipelines
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" id="__nav_5_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_2">
          Data Lake
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Data Lake" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
          Data Lake
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../snowflake/">
        Snowflake
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6">
          Manual Procedures
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Manual Procedures" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          Manual Procedures
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../manual_procedures/EMERGENCY_PLAN/">
        Emergency Recovery Plan
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../manual_procedures/API_VENDOR_ACCESS/">
        Grant vendors access to the Data Lake API
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../manual_procedures/SWITCH_AUTOMATION_ENGINE_REGION/">
        Switch Automation Engine's region
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7">
          Backups Recovery Plans
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Backups Recovery Plans" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
          Backups Recovery Plans
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1" id="__nav_7_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_1">
          AWS
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="AWS" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_1">
<span class="md-nav__icon md-icon"></span>
          AWS
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../backups/ECR_RECOVERY_PLAN/">
        ECR
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../backups/EKS_SSH_RECOVERY_PLAN/">
        EKS SSH
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2" id="__nav_7_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_2">
          Infrastructure
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Infrastructure" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_2">
<span class="md-nav__icon md-icon"></span>
          Infrastructure
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../backups/TERRAFORM_RECOVERY_PLAN/">
        Terraform
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3" id="__nav_7_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_3">
          Metrics
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Metrics" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_3">
<span class="md-nav__icon md-icon"></span>
          Metrics
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../backups/PROMETHEUS_RECOVERY_PLAN/">
        Prometheus
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_4" id="__nav_7_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_4">
          Source Code
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Source Code" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_4">
<span class="md-nav__icon md-icon"></span>
          Source Code
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../backups/GIT_RECOVERY_PLAN/">
        GIT repository
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_5" id="__nav_7_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_5">
          System Configuration
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="System Configuration" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_5">
<span class="md-nav__icon md-icon"></span>
          System Configuration
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../lambda/PARAMETER_REPLICATOR/">
        Parameters Replication
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8">
          Manual Configurations
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Manual Configurations" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
          Manual Configurations
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../manual_configurations/INIT_AUTOMATION_PROJECT/">
        Initialize Automation Engine project
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_2" id="__nav_8_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_2">
          AWS SSO - OKTA
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="AWS SSO - OKTA" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_8_2">
<span class="md-nav__icon md-icon"></span>
          AWS SSO - OKTA
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../manual_configurations/OKTA_CONFIGURATIONS/">
        Configurations
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../manual_configurations/OKTA_JWT/">
        JWT token
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<div align="center">
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="https://media.licdn.com/dms/image/C4E0BAQHrME9aCW6ulg/company-logo_200_200/0?e=2159024400&amp;v=beta&amp;t=6xMNS1zK1F8asBlM16EzbJ4Im7SlQ8L7a7sgcaNzZQE"><img height="200" src="https://media.licdn.com/dms/image/C4E0BAQHrME9aCW6ulg/company-logo_200_200/0?e=2159024400&amp;v=beta&amp;t=6xMNS1zK1F8asBlM16EzbJ4Im7SlQ8L7a7sgcaNzZQE" width="200"/></a>
</div>
<h1 id="create-new-microservice">CREATE NEW MICROSERVICE</h1>
<blockquote>
<p>This process describes step by step how to create a new microservice, from the ECR repository to the helm chart templates that 
define the microservice. All of this is created from the Gitlab repository in the pipeline; no need for more tools or actions 
by the developer. </p>
</blockquote>
<h2 id="introduction">Introduction</h2>
<p>The process requires that the steps be carried out in order. Basically, it is necessary to create the ECR repository
first so that we can then start developing and testing our new microservice in ephemeral environments or in production.</p>
<h2 id="1-create-ecr-repository">1. Create ECR repository</h2>
<p>We can't create the ECR repository in the branch where we are developing because the creation or update of the ECR repositories 
is only in the Master branch. This means that the first thing that we need to do is make a little merge to master to create our 
new microservice repo, by that way we can deploy our microservice later in dev branches.</p>
<ul>
<li>create a new branch from master</li>
<li>create a new terraform ECR repo file in the folder: <code>infra-as-code/basic-infra/3-registry</code> you can copy any of the other repos to have an example.<ul>
<li>this is an example:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>resource <span class="s2">"aws_ecr_repository"</span> <span class="s2">"new-bridge-repository"</span> <span class="o">{</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="nv">name</span> <span class="o">=</span> <span class="s2">"new-bridge"</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="nv">tags</span> <span class="o">=</span> <span class="o">{</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="nv">Project</span>       <span class="o">=</span> var.common_info.project
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span class="nv">Provisioning</span>  <span class="o">=</span> var.common_info.provisioning
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="nv">Module</span>        <span class="o">=</span> <span class="s2">"new-bridge"</span>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="o">}</span>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="o">}</span>
</code></pre></div></li>
</ul>
</li>
<li>merge the new repository to Master branch. The pipeline will run and create the new ECR repo <code>new-bridge</code></li>
</ul>
<h2 id="2-create-our-new-microservice-folder">2. Create our new microservice folder</h2>
<p>We can start working on our new microservice based on an existing one. It depends on if is a <code>capability</code>(bridges) or a <code>use case</code>. Select one or other depends on what are you developing. For example let's copy a capability "bruing-bridge" and paste in the root of the repo to change his name to "new-bridge". from this moment you can start to develop and do your tests locally. Every microservice must have the following directory structure:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>new-bridge
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>├── .gitlab-ci.yml
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>├── Dockerfile
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>├── README.md
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>├── package.json
<a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>├── requirements.txt
<a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a>├── setup.py
<a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a>└── src
<a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a>    ├── app.py
<a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a>    ├── application
<a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a>    │   └── ...
<a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a>    ├── config
<a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a>    │   └── ...
<a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a>    └── tests
<a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a>        └── ...
</code></pre></div>
<h2 id="3-update-ci-cd-gitlab-files-with-the-proper-values">3. Update CI-CD gitlab files with the proper values</h2>
<p>It's important to have the .gitlab-ci.yaml files correctly defined to enable pipelines:
  * <code>new-bridge/.gitlab-ci.yml</code>
  Change any reference of the template microservice to the new one: example find and replace "bruin-bridge" for "new-bridge"
  * <code>.gitlab-ci.yml</code> (the file in the root of the repository)
  Here we need to define the "desired_tasks" variable for this new micro (do it respecting the alphabetical order):
  <div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>...
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>  NATS_SERVER_DESIRED_TASKS: "1"
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>  NATS_SERVER_1_DESIRED_TASKS: "1"
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>  NATS_SERVER_2_DESIRED_TASKS: "1"
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>  NEW_BRIDGE_DESIRED_TASKS: "1"    &lt;─────────────── here!
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>  SERVICE_AFFECTING_MONITOR_DESIRED_TASKS: "1"
<a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a>  SERVICE_OUTAGE_MONITOR_1_DESIRED_TASKS: "1"
<a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a>...
</code></pre></div></p>
<h2 id="3-configure-semantic-release">3. Configure semantic-release</h2>
<p>We need to edit a file in the new micro path:
  * <code>new-bridge/package.json</code>
  update the name of the micro with our new working name:
  <div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>{
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>    "name": "new-bridge",    &lt;─────────────── here!
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>    "version": "0.0.1",
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>    "dependencies": {},
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>    "devDependencies": {}
<a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a>}
</code></pre></div></p>
<h2 id="3-configure-logs">3. Configure logs</h2>
<p>We use 2 systems to storage logs, papertrail for 3 days and cloudwath for 1 month. Let's add those config in:
  * <code>ci-utils/papertrail-provisioning/config.py</code>
  just copy one block form other microservice and paste with the name of our new micro (do it respecting the alphabetical order):
  <div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>...
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a>                {
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a>                    "query": f"lumin-billing-report AND {ENVIRONMENT_NAME} AND &lt;BUILD_NUMBER&gt;",
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a>                    "search_name": f"[lumin-billing-report] - logs",
<a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a>                    "repository": "lumin-billing-report",
<a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>                },
<a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a>                {                                                                       ¯│
<a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a>                    "query": f"new-bridge AND {ENVIRONMENT_NAME} AND &lt;BUILD_NUMBER&gt;",    │
<a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a>                    "search_name": f"[new-bridge] - logs",                               ├──────────────&gt; here!
<a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a>                    "repository": "new-bridge",                                          │
<a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a>                },                                                                      _│
<a href="#__codelineno-4-12" id="__codelineno-4-12" name="__codelineno-4-12"></a>...
</code></pre></div></p>
<ul>
<li><code>helm/charts/fluent-bit-custom/templates/configmap.yaml</code>
  The same; copy one block form other microservice and paste with the name of our new micro (do it respecting the alphabetical order):
  <div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a>...
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a>    [OUTPUT]
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>        Name                cloudwatch
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a>        Match               kube.var.log.containers.lumin-billing-report*
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a>        region              {{ .Values.config.region }}
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a>        log_group_name      {{ .Values.config.logGroupName }}
<a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>        log_stream_name     lumin-billing-report
<a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a>        auto_create_group   true
<a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a>    [OUTPUT]                                                      ¯│
<a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a>        Name                cloudwatch                             │
<a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a>        Match               kube.var.log.containers.new-bridge*    │
<a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a>        region              {{ .Values.config.region }}            ├──────────────&gt; here!
<a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a>        log_group_name      {{ .Values.config.logGroupName }}      │
<a href="#__codelineno-5-14" id="__codelineno-5-14" name="__codelineno-5-14"></a>        log_stream_name     new-bridge                             │
<a href="#__codelineno-5-15" id="__codelineno-5-15" name="__codelineno-5-15"></a>        auto_create_group   true                                  _│
<a href="#__codelineno-5-16" id="__codelineno-5-16" name="__codelineno-5-16"></a>...
</code></pre></div></li>
</ul>
<h2 id="3-update-docker-compose-to-enable-local-deployments">3. Update docker-compose to enable local deployments</h2>
<ul>
<li><code>docker-compose.yml</code> here we define our container along with the rest of the microservices. Just add the definition of our container respecting the alphabetical order:
  <div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a>...
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a>new-bridge:                                                          ¯│
<a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a>  build:                                                              │
<a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a>    # Context must be the root of the monorepo                        │
<a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a>    context: .                                                        │
<a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a>    dockerfile: new-bridge/Dockerfile                                 │
<a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a>    args:                                                             │
<a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a>      REPOSITORY_URL: 374050862540.dkr.ecr.us-east-1.amazonaws.com    ├──────────────&gt; here!
<a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a>  env_file:                                                           │
<a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a>    - new-bridge/src/config/env                                       │
<a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a>  depends_on:                                                         │
<a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a>    - "nats-server"                                                   │
<a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a>    - redis                                                           │
<a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a>  ports:                                                              │
<a href="#__codelineno-6-15" id="__codelineno-6-15" name="__codelineno-6-15"></a>    - 5006:5000                                                      _│
<a href="#__codelineno-6-16" id="__codelineno-6-16" name="__codelineno-6-16"></a>...
</code></pre></div></li>
</ul>
<h2 id="4-add-option-to-enable-or-disable-our-microservice">4. Add option to enable or disable our microservice</h2>
<ul>
<li><code>helm/charts/automation-engine/Chart.yaml</code> in this file we define our Automation-engine chart version and his dependencies. Let's add a condition for our microservice to have the possibility of disable or enable in our future deployments.
  <div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a>...
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>- name: lumin-billing-report
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a>  version: '*.*.*'
<a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a>  condition: lumin-billing-report.enabled
<a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a>- name: new-bridge                          ¯│
<a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a>  version: '*.*.*'                           ├──────────────&gt; here!
<a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a>  condition: new-bridge.enabled             _│
<a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a>...
</code></pre></div></li>
</ul>
<h2 id="5-helm-templates-and-variables">5. Helm templates and variables</h2>
<p>Here we will define the infrastructure part of our microservice with a helm chart. Is very important to know that this "how to" is only to copy an existing microservice, therefore, we take the following statements for granted:
1. The microservice will not have a public endpoint (except email-tagger-monitor)
2. The microservice port will always be 5000
3. Depends on the base chart you use to copy &amp; paste, you will have more or less kubernetes resources. although most microservices have: configmap, deployment, secret and service.</p>
<p>Perfect, now let's copy and paste another chart to use as template, if we will develop a use-case, we must copy the most similar use-case. For this example we are creating a "new-bridge", so let's copy a "bruin-bridge" as a template:
  * BASE-FOLDER: copy this folder <code>helm/charts/automation-engine/charts/bruin-bridge</code> and paste here <code>helm/charts/automation-engine/charts/</code> we will have something like <code>bruin-bridge copy</code>change the name to <code>new-bridge</code>. </p>
<ul>
<li>
<p>PREPARE BASE_FOLDER: now let's do a find and replace in our new folder <code>new-bridge</code>. find <code>bruin-bridge</code>and replace for <code>new-bridge</code>. many substitutions should appear (at the moment of write this, i can see 46 substitutions in 10 files but over time, this can change). Just remember to do this in the <code>new-bridge</code> folder context to evoid modify other resources.</p>
</li>
<li>
<p>DEPENDENCIES and CHECKS: Now we have to customize our new microservice, first we must ask ourselves, what dependency does my new microservice have on other services? for example, bruin-bridge have a dependency with Nats and Redis, so it have a few checks to see if those services are available and if they are, it can be deployed. We can find this checks in the <code>deployment.yaml</code> file. Specifically in this part:
  <div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a>...
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a>      initContainers:
<a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a>        - name: wait-nats-server
<a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a>          image: busybox:1.28
<a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a>          command: ['sh', '-c', 'until wget --spider -S http://automation-engine-nats:8222/varz; do echo waiting for nats-server; sleep 2; done']
<a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a>        - name: wait-redis
<a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a>          image: busybox:1.28
<a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a>          command: ['sh', '-c', 'until printf "PING\r\n" | nc ${REDIS_HOSTNAME} 6379; do echo waiting for redis; sleep 2; done']
<a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a>          envFrom:
<a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a>            - configMapRef:
<a href="#__codelineno-8-11" id="__codelineno-8-11" name="__codelineno-8-11"></a>                name: {{ include "new-bridge.configmapName" . }}
<a href="#__codelineno-8-12" id="__codelineno-8-12" name="__codelineno-8-12"></a>...
</code></pre></div>
  We can add or remove all the init containers we want. Even, it is very possible that all the dependencies that we need already have the microservice that we use as a base or some other microservice already developed. So we can navigate through the folders of the rest of the microservices and copy any other dependency check and use it in ours. I will add a new dependency for <code>notifications-bridge</code> copied from other microservice, and my file will look like the following:
  <div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a>...
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>      initContainers:
<a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a>        - name: wait-nats-server
<a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a>          image: busybox:1.28
<a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a>          command: ['sh', '-c', 'until wget --spider -S http://automation-engine-nats:8222/varz; do echo waiting for nats-server; sleep 2; done']
<a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a>        - name: wait-redis
<a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a>          image: busybox:1.28
<a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a>          command: ['sh', '-c', 'until printf "PING\r\n" | nc ${REDIS_HOSTNAME} 6379; do echo waiting for redis; sleep 2; done']
<a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a>          envFrom:
<a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a>            - configMapRef:
<a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a>                name: {{ include "new-bridge.configmapName" . }}
<a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a>        {{- if .Values.config.capabilities_enabled.notifications_bridge }}                                                                                    ¯│                                                                     
<a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a>        - name: wait-notifications-bridge                                                                                                                      │
<a href="#__codelineno-9-14" id="__codelineno-9-14" name="__codelineno-9-14"></a>          image: busybox:1.28                                                                                                                                  ├──────────────&gt; here!
<a href="#__codelineno-9-15" id="__codelineno-9-15" name="__codelineno-9-15"></a>          command: ['sh', '-c', 'until wget --spider -S http://notifications-bridge:5000/_health; do echo waiting for notifications-bridge; sleep 2; done']    │
<a href="#__codelineno-9-16" id="__codelineno-9-16" name="__codelineno-9-16"></a>        {{- end }}                                                                                                                                            _│
<a href="#__codelineno-9-17" id="__codelineno-9-17" name="__codelineno-9-17"></a>...
</code></pre></div>
  Note that we have a <code>if</code> condition. You will see this in some check, we use this because if we deploy only some microservices, we must contemplate this. If the notifications-bridge does not exist, the check will not be created. Nats and Redis are always required, that's wy don't have the conditional.</p>
</li>
<li>
<p>VARIABLES: time to update the variables that will use our microservice, this involves various files:</p>
<ul>
<li>
<p><code>helm/charts/automation-engine/charts/new-bridge/templates/configmap.yaml</code> this file always will be part of the deployment, it contains the variables base and the variables with no sensitive information. let's add a new variable NEW_VAR:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a>...
<a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a>  CURRENT_ENVIRONMENT: {{ .Values.global.current_environment }}
<a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a>  ENVIRONMENT_NAME: "{{ .Values.global.environment }}"
<a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a>  NATS_SERVER1: {{ .Values.global.nats_server }}
<a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a>  NEW_VAR: "{{ .Values.config.new_var }}"    &lt;─────────────── here!
<a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a>  REDIS_HOSTNAME: {{ .Values.global.redis_hostname }}
<a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a>  PAPERTRAIL_ACTIVE: "{{ .Values.global.papertrail_active }}"
<a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a>  PAPERTRAIL_HOST: {{ .Values.global.papertrail_host }}
<a href="#__codelineno-10-9" id="__codelineno-10-9" name="__codelineno-10-9"></a>  PAPERTRAIL_PORT: "{{ .Values.global.papertrail_port }}"
<a href="#__codelineno-10-10" id="__codelineno-10-10" name="__codelineno-10-10"></a>  PAPERTRAIL_PREFIX: "{{ .Values.config.papertrail_prefix }}"
<a href="#__codelineno-10-11" id="__codelineno-10-11" name="__codelineno-10-11"></a>...
</code></pre></div>
You can see here two important things, 1. there are variables with quotes and without quotes: this depends on your needs, if you don't put quotes, YAML will interpret the best case for you.. example, if you put a number like 5 as a value, YAML will interpret this as an integer, but careful, this could be a danger if your application expects a string variable; if this is the case, use quotes to define your var. 2. Additionally, we have variables of two types: "global" and "config". The global ones are common for all microservices, and the "config" is specific for this microservice. All the additional variables that we add will be of the type "config"</p>
</li>
<li>
<p><code>helm/charts/automation-engine/charts/new-bridge/templates/secret.yaml</code> this file may or may not exist in the chart and contains variables that have sensitive information. This info will be encoded with base64 to no show in clear text. let's add a new variable NEW_SENSITIVE_VAR:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a>apiVersion: v1
<a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a>kind: Secret
<a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a>metadata:
<a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a>  name: {{ include "new-bridge.secretName" . }}
<a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a>  labels:
<a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a>    {{- include "new-bridge.labels" . | nindent 4 }}
<a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a>  annotations:
<a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a>    reloader.stakater.com/match: "true"
<a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a>data:
<a href="#__codelineno-11-10" id="__codelineno-11-10" name="__codelineno-11-10"></a>  NEW_SENSITIVE_VAR: {{ .Values.config.new_sensitive_var | b64enc }}    &lt;─────────────── here!
</code></pre></div></p>
</li>
<li>
<p><code>helm/charts/automation-engine/charts/new-bridge/values.yaml</code> Now that we add our new variable in the configmap.yaml, we have to define it in our values file in order to use it. As you can see above, the definition of our variable points to the values file of our microservice; "Values.config.new_var" so let's go update it:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a>...
<a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a>config:    &lt;─────────────── in config section!!!
<a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a>  papertrail_prefix: ""
<a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a>  # -- New useful variable with no sensitive information   ¯│______________ here the configmap variable!
<a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a>  new_var: ""                                              _│
<a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a>  # -- New useful variable with sensitive information      ¯│______________ and here the secret variable!
<a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a>  new_sensitive_var: ""                                    _│
<a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a>...
</code></pre></div>
Check that we only define the variable but no put any value, although we can also set a default value if we want.</p>
</li>
<li>
<p><code>helm/charts/automation-engine/values.yaml</code> This is the values template off the entire automation-engine application. This only have the structure of the values and no contain any real value. For this part we will copy the content of the values file that we just created and paste in the place that correspond (respecting the alphabetical order). It's important to note that we are pasting the values inside another Yaml, so we must adapt the indentation for the destiny file:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a>...
<a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a># -- lumin-billing-report subchart specific configuration
<a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a>lumin-billing-report:
<a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a>  # -- Field to indicate if the lumin-billing-report module is going to be deployed
<a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a>  enabled: true
<a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a>  # -- Number of replicas of lumin-billing-report module
<a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a>  replicaCount: 1
<a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a>  config:
<a href="#__codelineno-13-9" id="__codelineno-13-9" name="__codelineno-13-9"></a>    # -- Papertrail prefix for create logs definition
<a href="#__codelineno-13-10" id="__codelineno-13-10" name="__codelineno-13-10"></a>    papertrail_prefix: ""
<a href="#__codelineno-13-11" id="__codelineno-13-11" name="__codelineno-13-11"></a>    # -- URI of Lumin API
<a href="#__codelineno-13-12" id="__codelineno-13-12" name="__codelineno-13-12"></a>    lumin_uri: ""
<a href="#__codelineno-13-13" id="__codelineno-13-13" name="__codelineno-13-13"></a>    # -- Token credentials for Lumin API
<a href="#__codelineno-13-14" id="__codelineno-13-14" name="__codelineno-13-14"></a>    lumin_token: ""
<a href="#__codelineno-13-15" id="__codelineno-13-15" name="__codelineno-13-15"></a>    # -- Name of customer to generate lumin-billing-report
<a href="#__codelineno-13-16" id="__codelineno-13-16" name="__codelineno-13-16"></a>    customer_name: ""
<a href="#__codelineno-13-17" id="__codelineno-13-17" name="__codelineno-13-17"></a>    # -- Email address to send lumin-billing-report
<a href="#__codelineno-13-18" id="__codelineno-13-18" name="__codelineno-13-18"></a>    billing_recipient: ""
<a href="#__codelineno-13-19" id="__codelineno-13-19" name="__codelineno-13-19"></a>  image:
<a href="#__codelineno-13-20" id="__codelineno-13-20" name="__codelineno-13-20"></a>    repository: 374050862540.dkr.ecr.us-east-1.amazonaws.com/lumin-billing-report
<a href="#__codelineno-13-21" id="__codelineno-13-21" name="__codelineno-13-21"></a>    pullPolicy: Always
<a href="#__codelineno-13-22" id="__codelineno-13-22" name="__codelineno-13-22"></a>    # Overrides the image tag whose default is the chart appVersion.
<a href="#__codelineno-13-23" id="__codelineno-13-23" name="__codelineno-13-23"></a>    tag: ""
<a href="#__codelineno-13-24" id="__codelineno-13-24" name="__codelineno-13-24"></a>  service:
<a href="#__codelineno-13-25" id="__codelineno-13-25" name="__codelineno-13-25"></a>    type: ClusterIP
<a href="#__codelineno-13-26" id="__codelineno-13-26" name="__codelineno-13-26"></a>    port: 5000
<a href="#__codelineno-13-27" id="__codelineno-13-27" name="__codelineno-13-27"></a>  resources:
<a href="#__codelineno-13-28" id="__codelineno-13-28" name="__codelineno-13-28"></a>    limits:
<a href="#__codelineno-13-29" id="__codelineno-13-29" name="__codelineno-13-29"></a>      cpu: 200m
<a href="#__codelineno-13-30" id="__codelineno-13-30" name="__codelineno-13-30"></a>      memory: 256Mi
<a href="#__codelineno-13-31" id="__codelineno-13-31" name="__codelineno-13-31"></a>    requests:
<a href="#__codelineno-13-32" id="__codelineno-13-32" name="__codelineno-13-32"></a>      cpu: 100m
<a href="#__codelineno-13-33" id="__codelineno-13-33" name="__codelineno-13-33"></a>      memory: 128Mi
<a href="#__codelineno-13-34" id="__codelineno-13-34" name="__codelineno-13-34"></a>
<a href="#__codelineno-13-35" id="__codelineno-13-35" name="__codelineno-13-35"></a># -- new-bridge subchart specific configuration                           ¯│
<a href="#__codelineno-13-36" id="__codelineno-13-36" name="__codelineno-13-36"></a>new-bridge:                                                                │
<a href="#__codelineno-13-37" id="__codelineno-13-37" name="__codelineno-13-37"></a>  replicaCount: 1                                                          │
<a href="#__codelineno-13-38" id="__codelineno-13-38" name="__codelineno-13-38"></a>  enabled: true                                                            │
<a href="#__codelineno-13-39" id="__codelineno-13-39" name="__codelineno-13-39"></a>  config:                                                                  │
<a href="#__codelineno-13-40" id="__codelineno-13-40" name="__codelineno-13-40"></a>    papertrail_prefix: ""                                                  │
<a href="#__codelineno-13-41" id="__codelineno-13-41" name="__codelineno-13-41"></a>    # -- New useful variable with no sensitive information                 │
<a href="#__codelineno-13-42" id="__codelineno-13-42" name="__codelineno-13-42"></a>    new_var: ""                                                            │
<a href="#__codelineno-13-43" id="__codelineno-13-43" name="__codelineno-13-43"></a>    # -- New useful variable with sensitive information                    │
<a href="#__codelineno-13-44" id="__codelineno-13-44" name="__codelineno-13-44"></a>    new_sensitive_var: ""                                                  │
<a href="#__codelineno-13-45" id="__codelineno-13-45" name="__codelineno-13-45"></a>  image:                                                                   │
<a href="#__codelineno-13-46" id="__codelineno-13-46" name="__codelineno-13-46"></a>    repository: 374050862540.dkr.ecr.us-east-1.amazonaws.com/new-bridge    ├──────────────&gt; here!
<a href="#__codelineno-13-47" id="__codelineno-13-47" name="__codelineno-13-47"></a>    pullPolicy: Always                                                     │
<a href="#__codelineno-13-48" id="__codelineno-13-48" name="__codelineno-13-48"></a>    # Overrides the image tag whose default is the chart appVersion.       │
<a href="#__codelineno-13-49" id="__codelineno-13-49" name="__codelineno-13-49"></a>    tag: ""                                                                │
<a href="#__codelineno-13-50" id="__codelineno-13-50" name="__codelineno-13-50"></a>  service:                                                                 │
<a href="#__codelineno-13-51" id="__codelineno-13-51" name="__codelineno-13-51"></a>    type: ClusterIP                                                        │
<a href="#__codelineno-13-52" id="__codelineno-13-52" name="__codelineno-13-52"></a>    port: 5000                                                             │
<a href="#__codelineno-13-53" id="__codelineno-13-53" name="__codelineno-13-53"></a>  resources:                                                               │
<a href="#__codelineno-13-54" id="__codelineno-13-54" name="__codelineno-13-54"></a>    limits:                                                                │
<a href="#__codelineno-13-55" id="__codelineno-13-55" name="__codelineno-13-55"></a>      cpu: 200m                                                            │
<a href="#__codelineno-13-56" id="__codelineno-13-56" name="__codelineno-13-56"></a>      memory: 256Mi                                                        │
<a href="#__codelineno-13-57" id="__codelineno-13-57" name="__codelineno-13-57"></a>    requests:                                                              │
<a href="#__codelineno-13-58" id="__codelineno-13-58" name="__codelineno-13-58"></a>      cpu: 100m                                                            │
<a href="#__codelineno-13-59" id="__codelineno-13-59" name="__codelineno-13-59"></a>      memory: 128Mi                                                       _│
<a href="#__codelineno-13-60" id="__codelineno-13-60" name="__codelineno-13-60"></a>...
</code></pre></div>
Things to check: first the indentation!!.. second, the "global" config is not set here; it is defined at the beginning of the values file and is common for all microservices. and finally, we remove blank and default configurations to get a shorter file (things removed: autoscaling, the default is false, so we can omit it. nodeSelector. tolerations and affinity). PD: You can keep autoscaling if you will enable it.</p>
</li>
<li>
<p><code>helm/charts/automation-engine/values.yaml.tpl</code> This is the most important file, it contains the values that will be parsed and used to deploy the Automation-Engine application. Basically it's the same file of values.yaml, but with the variables that will be replaced in the pipeline to deploy a production or develop environment. Let's add our new micro with the variables:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a>...
<a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a># -- lumin-billing-report subchart specific configuration
<a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a>lumin-billing-report:
<a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a>  enabled: ${LUMIN_BILLING_REPORT_ENABLED}
<a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a>  replicaCount: ${LUMIN_BILLING_REPORT_DESIRED_TASKS}
<a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a>  config:
<a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a>    # -- Papertrail prefix for create logs definition
<a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a>    papertrail_prefix: "lumin-billing-report-${LUMIN_BILLING_REPORT_BUILD_NUMBER}"
<a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a>    # -- URI of Lumin API
<a href="#__codelineno-14-10" id="__codelineno-14-10" name="__codelineno-14-10"></a>    lumin_uri: ${LUMIN_URI}
<a href="#__codelineno-14-11" id="__codelineno-14-11" name="__codelineno-14-11"></a>    # -- Token credentials for Lumin API
<a href="#__codelineno-14-12" id="__codelineno-14-12" name="__codelineno-14-12"></a>    lumin_token: ${LUMIN_TOKEN}
<a href="#__codelineno-14-13" id="__codelineno-14-13" name="__codelineno-14-13"></a>    # -- Name of customer to generate lumin-billing-report
<a href="#__codelineno-14-14" id="__codelineno-14-14" name="__codelineno-14-14"></a>    customer_name: ${CUSTOMER_NAME_BILLING_REPORT}
<a href="#__codelineno-14-15" id="__codelineno-14-15" name="__codelineno-14-15"></a>    # -- Email address to send lumin-billing-report
<a href="#__codelineno-14-16" id="__codelineno-14-16" name="__codelineno-14-16"></a>    billing_recipient: ${BILLING_RECIPIENT}
<a href="#__codelineno-14-17" id="__codelineno-14-17" name="__codelineno-14-17"></a>  image:
<a href="#__codelineno-14-18" id="__codelineno-14-18" name="__codelineno-14-18"></a>    repository: 374050862540.dkr.ecr.us-east-1.amazonaws.com/lumin-billing-report
<a href="#__codelineno-14-19" id="__codelineno-14-19" name="__codelineno-14-19"></a>    pullPolicy: Always
<a href="#__codelineno-14-20" id="__codelineno-14-20" name="__codelineno-14-20"></a>    # Overrides the image tag whose default is the chart appVersion.
<a href="#__codelineno-14-21" id="__codelineno-14-21" name="__codelineno-14-21"></a>    tag: ${LUMIN_BILLING_REPORT_BUILD_NUMBER}
<a href="#__codelineno-14-22" id="__codelineno-14-22" name="__codelineno-14-22"></a>  service:
<a href="#__codelineno-14-23" id="__codelineno-14-23" name="__codelineno-14-23"></a>    type: ClusterIP
<a href="#__codelineno-14-24" id="__codelineno-14-24" name="__codelineno-14-24"></a>    port: 5000
<a href="#__codelineno-14-25" id="__codelineno-14-25" name="__codelineno-14-25"></a>  resources:
<a href="#__codelineno-14-26" id="__codelineno-14-26" name="__codelineno-14-26"></a>    limits:
<a href="#__codelineno-14-27" id="__codelineno-14-27" name="__codelineno-14-27"></a>      cpu: 200m
<a href="#__codelineno-14-28" id="__codelineno-14-28" name="__codelineno-14-28"></a>      memory: 256Mi
<a href="#__codelineno-14-29" id="__codelineno-14-29" name="__codelineno-14-29"></a>    requests:
<a href="#__codelineno-14-30" id="__codelineno-14-30" name="__codelineno-14-30"></a>      cpu: 100m
<a href="#__codelineno-14-31" id="__codelineno-14-31" name="__codelineno-14-31"></a>      memory: 128Mi
<a href="#__codelineno-14-32" id="__codelineno-14-32" name="__codelineno-14-32"></a>
<a href="#__codelineno-14-33" id="__codelineno-14-33" name="__codelineno-14-33"></a>
<a href="#__codelineno-14-34" id="__codelineno-14-34" name="__codelineno-14-34"></a># -- new-bridge subchart specific configuration                           ¯│
<a href="#__codelineno-14-35" id="__codelineno-14-35" name="__codelineno-14-35"></a>new-bridge:                                                                │
<a href="#__codelineno-14-36" id="__codelineno-14-36" name="__codelineno-14-36"></a>  replicaCount: ${NEW_BRIDGE_DESIRED_TASKS}                                │
<a href="#__codelineno-14-37" id="__codelineno-14-37" name="__codelineno-14-37"></a>  enabled: ${NEW_BRIDGE_ENABLED}                                           │
<a href="#__codelineno-14-38" id="__codelineno-14-38" name="__codelineno-14-38"></a>  config:                                                                  │
<a href="#__codelineno-14-39" id="__codelineno-14-39" name="__codelineno-14-39"></a>    papertrail_prefix: "new-bridge-${NEW_BRIDGE_BUILD_NUMBER}"             │
<a href="#__codelineno-14-40" id="__codelineno-14-40" name="__codelineno-14-40"></a>    # -- New useful variable with no sensitive information                 │
<a href="#__codelineno-14-41" id="__codelineno-14-41" name="__codelineno-14-41"></a>    new_var: ${NEW_BRIDGE_NEW_VAR}                                         │
<a href="#__codelineno-14-42" id="__codelineno-14-42" name="__codelineno-14-42"></a>    # -- New useful variable with sensitive information                    │
<a href="#__codelineno-14-43" id="__codelineno-14-43" name="__codelineno-14-43"></a>    new_sensitive_var: ${NEW_BRIDGE_NEW_SENSITIVE_VAR}                     │
<a href="#__codelineno-14-44" id="__codelineno-14-44" name="__codelineno-14-44"></a>  image:                                                                   │
<a href="#__codelineno-14-45" id="__codelineno-14-45" name="__codelineno-14-45"></a>    repository: 374050862540.dkr.ecr.us-east-1.amazonaws.com/new-bridge    ├──────────────&gt; here!
<a href="#__codelineno-14-46" id="__codelineno-14-46" name="__codelineno-14-46"></a>    pullPolicy: Always                                                     │
<a href="#__codelineno-14-47" id="__codelineno-14-47" name="__codelineno-14-47"></a>    # Overrides the image tag whose default is the chart appVersion.       │
<a href="#__codelineno-14-48" id="__codelineno-14-48" name="__codelineno-14-48"></a>    tag: ${NEW_BRIDGE_BUILD_NUMBER}                                        │
<a href="#__codelineno-14-49" id="__codelineno-14-49" name="__codelineno-14-49"></a>  service:                                                                 │
<a href="#__codelineno-14-50" id="__codelineno-14-50" name="__codelineno-14-50"></a>    type: ClusterIP                                                        │
<a href="#__codelineno-14-51" id="__codelineno-14-51" name="__codelineno-14-51"></a>    port: 5000                                                             │
<a href="#__codelineno-14-52" id="__codelineno-14-52" name="__codelineno-14-52"></a>  resources:                                                               │
<a href="#__codelineno-14-53" id="__codelineno-14-53" name="__codelineno-14-53"></a>    limits:                                                                │
<a href="#__codelineno-14-54" id="__codelineno-14-54" name="__codelineno-14-54"></a>      cpu: 200m                                                            │
<a href="#__codelineno-14-55" id="__codelineno-14-55" name="__codelineno-14-55"></a>      memory: 256Mi                                                        │
<a href="#__codelineno-14-56" id="__codelineno-14-56" name="__codelineno-14-56"></a>    requests:                                                              │
<a href="#__codelineno-14-57" id="__codelineno-14-57" name="__codelineno-14-57"></a>      cpu: 100m                                                            │
<a href="#__codelineno-14-58" id="__codelineno-14-58" name="__codelineno-14-58"></a>      memory: 128Mi                                                       _│
<a href="#__codelineno-14-59" id="__codelineno-14-59" name="__codelineno-14-59"></a>...
</code></pre></div>
With this, we have the entire template of our new microservice. Now we need to set in the pipeline the variables that we just created.</p>
</li>
<li>
<p><code>ci-utils/environments/deploy_environment_vars.sh</code> In this file, we define the variables that will be used in the values file. Most of the cases are variables that we create in GitLab with the value of dev and production environments. This file is a bash script that has multiple functions to define the variables, each function is for the microservice that requires those variables. If we are adding a new micro that requires variables, we need to define the function and in the bottom of the file execute that function. PD: no all microservices needs specific variables, so in some cases, we wouldn't need to touch this file or even create a secret.yaml. Rebember to respect the alphabetical order:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a>...
<a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a>function lumin_billing_report_variables() {
<a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a>  if [[ "${CI_COMMIT_REF_SLUG}" != "master" ]]; then
<a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a>    # lumin-billing-report environment variables for ephemeral environments
<a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a>    export BILLING_RECIPIENT=${BILLING_RECIPIENT_REPORT_DEV}
<a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a>  else
<a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a>    # lumin-billing-report environment variables for production environment
<a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a>    export BILLING_RECIPIENT=${BILLING_RECIPIENT_REPORT_PROD}
<a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a>  fi
<a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a>}
<a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a>
<a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a>function new_bridge_variables() {                                                       ¯│
<a href="#__codelineno-15-13" id="__codelineno-15-13" name="__codelineno-15-13"></a>  if [[ "${CI_COMMIT_REF_SLUG}" != "master" ]]; then                                     │
<a href="#__codelineno-15-14" id="__codelineno-15-14" name="__codelineno-15-14"></a>    # new-bridge environment variables for ephemeral environments                        │
<a href="#__codelineno-15-15" id="__codelineno-15-15" name="__codelineno-15-15"></a>    export NEW_BRIDGE_NEW_VARIABLE=${NEW_BRIDGE_NEW_VARIABLE_DEV}                        │
<a href="#__codelineno-15-16" id="__codelineno-15-16" name="__codelineno-15-16"></a>    export NEW_BRIDGE_NEW_SENSITIVE_VARIABLE=${NEW_BRIDGE_NEW_SENSITIVE_VARIABLE_DEV}    ├──────────────&gt; here!
<a href="#__codelineno-15-17" id="__codelineno-15-17" name="__codelineno-15-17"></a>  else                                                                                   │
<a href="#__codelineno-15-18" id="__codelineno-15-18" name="__codelineno-15-18"></a>    # new-bridge environment variables for production environment                        │
<a href="#__codelineno-15-19" id="__codelineno-15-19" name="__codelineno-15-19"></a>    export NEW_BRIDGE_NEW_VARIABLE=${NEW_BRIDGE_NEW_VARIABLE_PRO}                        │
<a href="#__codelineno-15-20" id="__codelineno-15-20" name="__codelineno-15-20"></a>    export NEW_BRIDGE_NEW_SENSITIVE_VARIABLE=${NEW_BRIDGE_NEW_SENSITIVE_VARIABLE_PRO}    │
<a href="#__codelineno-15-21" id="__codelineno-15-21" name="__codelineno-15-21"></a>  fi                                                                                     │
<a href="#__codelineno-15-22" id="__codelineno-15-22" name="__codelineno-15-22"></a>}                                                                                       _│ 
<a href="#__codelineno-15-23" id="__codelineno-15-23" name="__codelineno-15-23"></a>...
<a href="#__codelineno-15-24" id="__codelineno-15-24" name="__codelineno-15-24"></a>function environments_assign() {
<a href="#__codelineno-15-25" id="__codelineno-15-25" name="__codelineno-15-25"></a>  # assign enabled variable for each subchart
<a href="#__codelineno-15-26" id="__codelineno-15-26" name="__codelineno-15-26"></a>  create_enabled_var_for_each_subchart
<a href="#__codelineno-15-27" id="__codelineno-15-27" name="__codelineno-15-27"></a>  # assign common environment variables for each environment
<a href="#__codelineno-15-28" id="__codelineno-15-28" name="__codelineno-15-28"></a>  common_variables_by_environment
<a href="#__codelineno-15-29" id="__codelineno-15-29" name="__codelineno-15-29"></a>  # assign specific environment variables for each subchart
<a href="#__codelineno-15-30" id="__codelineno-15-30" name="__codelineno-15-30"></a>  bruin_bridge_variables
<a href="#__codelineno-15-31" id="__codelineno-15-31" name="__codelineno-15-31"></a>  cts_bridge_variables
<a href="#__codelineno-15-32" id="__codelineno-15-32" name="__codelineno-15-32"></a>  digi_bridge_variables
<a href="#__codelineno-15-33" id="__codelineno-15-33" name="__codelineno-15-33"></a>  digi_reboot_report_variables
<a href="#__codelineno-15-34" id="__codelineno-15-34" name="__codelineno-15-34"></a>  email_tagger_monitor_variables
<a href="#__codelineno-15-35" id="__codelineno-15-35" name="__codelineno-15-35"></a>  hawkeye_bridge_variables
<a href="#__codelineno-15-36" id="__codelineno-15-36" name="__codelineno-15-36"></a>  links_metrics_api_variables
<a href="#__codelineno-15-37" id="__codelineno-15-37" name="__codelineno-15-37"></a>  lit_bridge_variables
<a href="#__codelineno-15-38" id="__codelineno-15-38" name="__codelineno-15-38"></a>  lumin_billing_report_variables
<a href="#__codelineno-15-39" id="__codelineno-15-39" name="__codelineno-15-39"></a>  new_bridge_variables    &lt;─────────────── and here!
<a href="#__codelineno-15-40" id="__codelineno-15-40" name="__codelineno-15-40"></a>  t7_bridge_variables
<a href="#__codelineno-15-41" id="__codelineno-15-41" name="__codelineno-15-41"></a>  velocloud_bridge_variables
<a href="#__codelineno-15-42" id="__codelineno-15-42" name="__codelineno-15-42"></a>}
<a href="#__codelineno-15-43" id="__codelineno-15-43" name="__codelineno-15-43"></a>...
</code></pre></div></p>
</li>
<li>
<p><code>add the variables in gitlab-ci</code> finally, we have all the path until the real value in Gitlab. Let's go to the repository <a href="https://gitlab.intelygenz.com/mettel/automation-engine/-/settings/ci_cd">settings/ci-cd</a> section and create the new variables:
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../img/system_overview/gitlab_add_new_var.png"><img alt="IMAGE: gitlab_add_new_var" src="../img/system_overview/gitlab_add_new_var.png"/></a></p>
</li>
</ul>
</li>
</ul>
<p>That's all, with this and the proper <a href="..#commit">commit message</a> the pipeline will run and deploy an ephemeral environment.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Creating new metrics" class="md-footer__link md-footer__link--prev" href="../CREATE_NEW_METRIC/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              Creating new metrics
            </div>
</div>
</a>
<a aria-label="Next: Running in docker-compose" class="md-footer__link md-footer__link--next" href="../kafka/LAUNCH_DOCKER_COMPOSE/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              Running in docker-compose
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["header.autohide", "toc.follow", "toc.integrate"], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
<script src="../assets/javascripts/bundle.748e2769.min.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>