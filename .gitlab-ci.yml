stages:
  - validation
  - unit_test
  - basic_infra
  - build
  - deploy

variables:
  NATS_SERVER1: "nats://nats-server:4222"
  NATS_MODULE_VERSION: 2.1.0
  DOCKER_HOST: tcp://localhost:2375
  DOCKER_DRIVER: overlay2
  REPOSITORY_URL: 374050862540.dkr.ecr.us-east-1.amazonaws.com/automation
  IGZ_PACKAGES_REPOSITORY_URL: https://d3nllpcjtts00v.cloudfront.net/igzpackages/index.html
  IGZ_PACKAGES_VERSION: 1.0.9
  DOCKER_BASE_IMAGE_VERSION: 1.0.7
  DOCKER_IMAGE_UTILS_VERSION: 1.0.3
  bruin_bridge_desired_tasks: 2
  last_contact_report_desired_tasks: 1
  metrics_prometheus_desired_tasks: 1
  nats_server_desired_tasks: 1
  nats_server_1_desired_tasks: 1
  nats_server_2_desired_tasks: 1
  notifier_desired_tasks: 1
  service_affecting_monitor_desired_tasks: 1
  service_outage_monitor_1_desired_tasks: 1
  service_outage_monitor_2_desired_tasks: 1
  service_outage_monitor_3_desired_tasks: 1
  service_outage_monitor_4_desired_tasks: 0
  service_outage_monitor_triage_desired_tasks: 1
  sites_monitor_desired_tasks: 1
  t7_bridge_desired_tasks: 1
  velocloud_bridge_desired_tasks: 5

include:
  # Templates used in Gitlab-CI jobs
  - local: 'gitlab-ci/basic-templates/.gitlab-ci-build-image-templates.yml'
  - local: 'gitlab-ci/basic-templates/.gitlab-ci-unit_test-templates.yml'
  - local: 'gitlab-ci/basic-templates/.gitlab-ci-utils-templates.yml'
  - local: 'gitlab-ci/basic-templates/.gitlab-ci-validation-templates.yml'
  - local: 'gitlab-ci/terraform-templates/.gitlab-ci-terraform-basic-templates.yml'
  - local: 'gitlab-ci/terraform-templates/.gitlab-ci-terraform-deploy-templates.yml'
  - local: 'gitlab-ci/terraform-templates/.gitlab-ci-terraform-destroy-templates.yml'
  # Gitlab-CI jobs declaration for each microservice/module
  - local: 'bruin-bridge/.gitlab-ci.yml'
  - local: 'ci-utils/.gitlab-ci.yml'
  - local: 'dispatch-portal-frontend/.gitlab-ci.yml'
  - local: 'infra-as-code/.gitlab-ci.yml'
  - local: 'last-contact-report/.gitlab-ci.yml'
  - local: 'metrics-dashboard/.gitlab-ci.yml'
  - local: 'nats-server/.gitlab-ci.yml'
  - local: 'notifier/.gitlab-ci.yml'
  - local: 'service-affecting-monitor/.gitlab-ci.yml'
  - local: 'service-outage-monitor/.gitlab-ci.yml'
  - local: 't7-bridge/.gitlab-ci.yml'
  - local: 'velocloud-bridge/.gitlab-ci.yml'
  - local: 'sites-monitor/.gitlab-ci.yml'
