#
# Using gitlab-ci extends to reuse scripts between jobs (https://docs.gitlab.com/ee/ci/yaml/#extends)
#

.unittest_module_python: &unittest_module_python
  stage: unit_test
  image: ${CI_REGISTRY}/mettel/docker_images/python-3.6:${DOCKER_BASE_IMAGE_VERSION}
  before_script:
    - cd ${MODULE}
    - pip install -r requirements.txt
  script:
    - pytest --cov
  coverage: '/^TOTAL.+?(\d{2,3}.\d+\%)$/'
  tags:
    - kubernetes

.unittest_module_python_alpine: &unittest_module_python_alpine
  extends: .unittest_module_python
  image: ${CI_REGISTRY}/mettel/docker_images/python-3.6-alpine:${DOCKER_BASE_IMAGE_VERSION}

.unittest_with_setup_template: &unittest_with_setup_template
  stage: unit_test
  image: python:3.6
  before_script:
    - apt-get update -q -y
    - cd ${MODULE}
    - python setup.py install
  script:
    - pytest --cov
  coverage: '/^TOTAL.+?(\d{2,3}.\d+\%)$/'
  tags:
    - kubernetes
