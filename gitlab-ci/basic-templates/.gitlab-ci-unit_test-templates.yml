#
# Using gitlab-ci extends to reuse scripts between jobs (https://docs.gitlab.com/ee/ci/yaml/#extends)
#

.unittest_module: &unittest_module
  stage: unit_test
  image: python:3.6
  before_script:
    - apt-get update -q -y
    - cd ${MODULE}
    - pip install -r requirements.txt
  script:
    - pytest --cov
  coverage: '/^TOTAL.+?(\d{2,3}.\d+\%)$/'
  only:
    - master
    - /^*feature/.*$/
    - /^*fix/.*$/
    - /^*dev/feature/.*$/
    - /^*dev/fix/.*$/
  tags:
    - kubernetes

.unittest_with_setup_template: &unittest_with_setup_template
  stage: unit_test
  image: python:3.6
  before_script:
    - apt-get update -q -y
    - cd ${MODULE}
    - python setup.py install
  script:
    - pytest --cov
  coverage: '/^TOTAL.+?(\d{2,3}.\d+\%)$/'
  only:
    - master
    - /^*feature/.*$/
    - /^*fix/.*$/
    - /^*dev/feature/.*$/
    - /^*dev/fix/.*$/
  tags:
    - kubernetes

.unittest_custom_package_template: &unittest_custom_package_template
  stage: unit_test
  image: python:3.6
  before_script:
    - apt-get update -q -y
    - cd ${CUSTOM_PACKAGE_DIR}
    - python setup.py install
    - cd ${MODULE}
  script:
    - pytest --cov
  coverage: '/^TOTAL.+?(\d{2,3}.\d+\%)$/'
  only:
    - master
    - /^*feature/.*$/
    - /^*fix/.*$/
    - /^*dev/feature/.*$/
    - /^*dev/fix/.*$/
  tags:
    - kubernetes
