# Table of contents
- [Velocloud SDK integration](#velocloud-sdk-integration)
  * [Connecting to several clusters](#connecting-to-several-clusters)
  * [Service logic](#service-logic)
  * [Parallel drones](#parallel-drones)

# Velocloud SDK integration

## Connecting to several clusters
Velocloud provided us with an SDK. The SDK is currently located in the `custompackages` folder, so we use a locked
and customized (for large amounts of requests) version of it.

The service's Velocloud client will create a Velocloud's SDK client for each cluster the service must connect to.

Credentials are put inside an enviroment variable with the next schema:
`some.host.name+hostusername+hostpassword;other.host.name+otherusername+otherpassword`

In the `config.py`script, there's a way to split this into an array of dictionaries like this one:

````
        {'url': "some.host.name",
         'username': "hostusername",
         'password': "hostpassword"
         }
````

## Service logic
The drone will connect to the Message Queue `edge.status.task`.

For each task consumed, the service will ask to Velocloud about current state information of the edge and the
links on it. Based on the edge status, the service will filter the edges in faulty/ok.

Once all information is retrieved and filter is made (for a single edge), the whole information will be sent to 
`edge.status.ok`(for the OK edges) or `edge.status.ko`(for faulty ones).

A drone instance can perform any task generated by an overseer as long as they both have the same credentials array
for velocloud clusters, since the drone will check wich cluster it should go when getting the task from `edge.status.task` queue.


## Parallel drones
Is possible to have more than one replica of the drone working. They are in the same `durable group`(durable_name + queue in code) in NATS, so they share
the same offset as long as they belong to the same `durable group`.
