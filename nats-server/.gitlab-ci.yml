# ===================================
# release jobs for nats-server module
# ===================================
release-nats-server:
  stage: release
  image: node:10
  before_script:
    - npm install --prefix nats-server
  script:
    - cd nats-server && npx semantic-release -e semantic-release-monorepo
  rules:
    - if: '$CI_COMMIT_BRANCH == "master"'
      changes:
        - helm/charts/nats-server-custom/**/*
        - nats-server/.gitlab-ci.yml
  cache:
    policy: pull
    key: "helm-necessary-terraform-vars-${CI_COMMIT_REF_SLUG}"
    paths:
      - output
