# ================================================================
# Linter validation jobs for infra-as-code/ecr-repositories module
# ================================================================

terraform-valite-ecr-repositories:
  stage: validation
  extends: .terraform_template_validate_one_folder
  variables:
    MODULE: "infra-as-code/ecr-repositories"
  rules:
    - if: '$CI_COMMIT_BRANCH == "master" && $CI_COMMIT_TITLE =~ /(feat|fix|perf|refactor|build|destroy)\(.*\): .*$/'
      changes:
        - infra-as-code/ecr-repositories/**/*
    - if: '$CI_COMMIT_BRANCH == "master" && $CI_PIPELINE_SOURCE == "web"'

# ===================================================================
# Terraform deployment jobs for infra-as-code/ecr-repositories module
# ===================================================================
ecr-repositories:
  stage: basic_infra
  extends: .terraform_template_deploy_one_folder
  variables:
    MODULE: "infra-as-code/ecr-repositories"
  rules:
    - if: '$CI_COMMIT_BRANCH == "master" && $CI_COMMIT_TITLE =~ /(feat|fix|perf|refactor|build|destroy)\(.*\): .*$/'
      changes:
        - infra-as-code/ecr-repositories/**/*
    - if: '$CI_COMMIT_BRANCH == "master" && $CI_PIPELINE_SOURCE == "web"'
      when: manual
      allow_failure: true

# ================================================================
# Terraform destroy jobs for infra-as-code/ecr-repositories module
# ================================================================
destroy-ecr-repositories:
  stage: destroy
  extends: .terraform_template_destroy_one_folder
  variables:
    MODULE: "infra-as-code/ecr-repositories"
  rules:
    - if: '$CI_COMMIT_BRANCH == "master" && $CI_COMMIT_TITLE =~ /destroy\(.*\): .*$/'
      when: manual
      allow_failure: true
